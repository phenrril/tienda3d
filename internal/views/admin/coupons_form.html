{{define "admin_coupons_form.html"}}
{{template "layout_start" .}}
<h1>{{if .IsEdit}}Editar Cupón{{else}}Crear Cupón{{end}}</h1>
<nav class="admin-nav">
  <a href="/admin/products">Productos</a> | 
  <a href="/admin/orders">Órdenes</a> | 
  <a href="/admin/sales">Ventas</a> | 
  <a href="/admin/destacada">Destacada</a> | 
  <a href="/admin/costs">Calculadora</a> | 
  <a href="/admin/categorias">Categorías</a> | 
  <a href="/admin/cupones" class="active">Cupones</a> | 
  <a href="/admin/logout">Salir</a>
</nav>

<div style="margin-top:20px">
  <a href="/admin/cupones" class="btn-secondary">← Volver a la lista</a>
</div>

<form method="POST" action="{{if .IsEdit}}/admin/cupones/actualizar{{else}}/admin/cupones/crear{{end}}" style="max-width:600px;margin-top:20px">
  {{if .IsEdit}}
  <input type="hidden" name="id" value="{{.Coupon.ID}}" />
  {{end}}

  <div class="form-group" style="margin-bottom:20px">
    <label for="code" style="display:block;margin-bottom:8px;font-weight:600">Código del cupón *</label>
    <input 
      type="text" 
      id="code" 
      name="code" 
      required 
      class="checkout-input"
      placeholder="ej: CREADOR15"
      value="{{if .IsEdit}}{{.Coupon.Code}}{{end}}"
      style="text-transform:uppercase"
      {{if .IsEdit}}readonly{{end}}
    />
    <small style="color:var(--muted);font-size:12px">Se convertirá automáticamente a mayúsculas</small>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="discount_type" style="display:block;margin-bottom:8px;font-weight:600">Tipo de descuento *</label>
    <select id="discount_type" name="discount_type" required class="checkout-input">
      <option value="percentage" {{if .IsEdit}}{{if eq .Coupon.DiscountType "percentage"}}selected{{end}}{{end}}>Porcentaje (%)</option>
      <option value="fixed_amount" {{if .IsEdit}}{{if eq .Coupon.DiscountType "fixed_amount"}}selected{{end}}{{end}}>Monto fijo ($)</option>
    </select>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="discount_value" style="display:block;margin-bottom:8px;font-weight:600">Valor del descuento *</label>
    <input 
      type="number" 
      id="discount_value" 
      name="discount_value" 
      required 
      step="0.01"
      min="0.01"
      class="checkout-input"
      placeholder="ej: 15 (para 15% o $15)"
      value="{{if .IsEdit}}{{.Coupon.DiscountValue}}{{end}}"
    />
    <small style="color:var(--muted);font-size:12px">Para porcentaje: 1-100. Para monto fijo: valor en pesos</small>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="min_purchase_amount" style="display:block;margin-bottom:8px;font-weight:600">Monto mínimo de compra</label>
    <input 
      type="number" 
      id="min_purchase_amount" 
      name="min_purchase_amount" 
      step="0.01"
      min="0"
      class="checkout-input"
      placeholder="ej: 10000 (opcional, 0 = sin mínimo)"
      value="{{if .IsEdit}}{{.Coupon.MinPurchaseAmount}}{{else}}0{{end}}"
    />
    <small style="color:var(--muted);font-size:12px">Dejar en 0 para no requerir monto mínimo</small>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="max_uses" style="display:block;margin-bottom:8px;font-weight:600">Máximo de usos</label>
    <input 
      type="number" 
      id="max_uses" 
      name="max_uses" 
      min="1"
      class="checkout-input"
      placeholder="ej: 100 (opcional, vacío = ilimitado)"
      value="{{if .IsEdit}}{{if .Coupon.MaxUses}}{{.Coupon.MaxUses}}{{end}}{{end}}"
    />
    <small style="color:var(--muted);font-size:12px">Dejar vacío para uso ilimitado</small>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="expires_at" style="display:block;margin-bottom:8px;font-weight:600">Fecha de expiración</label>
    <input 
      type="date" 
      id="expires_at" 
      name="expires_at" 
      class="checkout-input"
      value="{{if .IsEdit}}{{if .Coupon.ExpiresAt}}{{.Coupon.ExpiresAt.Format "2006-01-02"}}{{end}}{{end}}"
    />
    <small style="color:var(--muted);font-size:12px">Dejar vacío para que no expire</small>
  </div>

  <div class="form-group" style="margin-bottom:20px">
    <label for="description" style="display:block;margin-bottom:8px;font-weight:600">Descripción interna</label>
    <textarea 
      id="description" 
      name="description" 
      rows="3"
      class="checkout-input"
      placeholder="ej: Cupón para influencer X"
      style="resize:vertical"
    >{{if .IsEdit}}{{.Coupon.Description}}{{end}}</textarea>
    <small style="color:var(--muted);font-size:12px">Descripción para uso interno (no visible para usuarios)</small>
  </div>

  {{if .IsEdit}}
  <div class="form-group" style="margin-bottom:20px">
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
      <input 
        type="checkbox" 
        name="active" 
        {{if .Coupon.Active}}checked{{end}}
      />
      <span style="font-weight:600">Cupón activo</span>
    </label>
    <small style="color:var(--muted);font-size:12px">Desmarcar para desactivar el cupón</small>
  </div>
  {{end}}

  <div style="margin-top:30px;display:flex;gap:12px">
    <button type="submit" class="btn-primary">{{if .IsEdit}}Actualizar cupón{{else}}Crear cupón{{end}}</button>
    <a href="/admin/cupones" class="btn-secondary">Cancelar</a>
  </div>
</form>

{{template "layout_end" .}}
{{end}}
